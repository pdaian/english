It's a usb dongle, using only one A3233.

## Hardware version 1.0
### Features

* VID/PID: 0x1FC9/0x0083
* Icarus protocol support
* It use USB CDC, without need driver installation under Linux
* Smart [[LED|#LED]] indicator
* Overheating protection. (>= 65℃)
* Adjust the hashrate automatically by temperature (~1.0GH/s -  ~3.6GH/s)

Note:  You may need install driver for windows before usage. Please down it here  (3.1)

### Software
It can support CGMiner, BFGMiner and AvalonMiner(Based on BFGMiner) for now.
#### CGMiner Under Ubuntu 14.04

* Download / Compile / Run
	**Download**
	Inside your home directory, download CGMiner
	git clone https://github.com/Canaan-Creative/cgminer

	**Compile**
	cd cgminer
	git checkout origin/avalon-usb -b avalon-usb
	./autogen.sh --enable-icarus
	make -j 4

	**Run**
	sudo ./cgminer --icarus-options 115200:1:1 --icarus-timing 0.22 -o http://stratum.pool:3333 -u  work -p pass 
	or
	sudo ./cgminer --icarus-options 115200:1:1 --icarus-timing 0.22 -o http://stratum.pool:3333 -u  work -p pass --api-allow W:192.168.2,W:192.168.2.1 --api-listen $@ 2>./log

* Patches
	Patch for Canaan Creative's CGMiner: [001-avalon3-nano.patch](http://downloads.canaan-creative.com/software/avalon_nano/patches/001-avalon3-nano.patch)
	For what: CGMiner patch.
	From where: Based c5ec1171@https://github.com/Canaan-Creative/cgminer/tree/avalon2
	Comments: 
	Support avalon3 nano in cgminer.
	Support Icarus protocol.

#### BFGMiner

* Run
	**Run under Linux**
	./bfgminer \
	-S ICA:/dev/ttyACMx \
	-o stratum+tcp://stratum.ozco.in:80 -O mikeqin.avalon:1234 \
	--set-device ICA:baud=115200 \
	--set-device ICA:reopen=timeout \
	--set-device ICA:work_division=1 \
	--set-device ICA:fpga_count=1 \
	--set-device ICA:probe_timeout=100 \
	--set-device ICA:timing=0.22 \
	--api-listen \
	2>log

	**Run under Windows**
	bfgminer.exe ^
	-S ICA:\\.\COMn ^
	-o stratum+tcp://stratum.ozco.in:80 -O mikeqin.avalon:1234 ^
	--set-device ICA:baud=115200 ^
	--set-device ICA:reopen=timeout ^
	--set-device ICA:work_division=1 ^
	--set-device ICA:fpga_count=1 ^
	--set-device ICA:probe_timeout=100 ^
	--set-device ICA:timing=0.22 ^
	--api-listen ^
	2>log
	
	Note: See the details about the timing in README. It works ~4GH/s(400 * 11.8) at 400MHz.
	timing = (1 / (4 * 10 ** 9)) * 10 ** 9 (python format)

* MHS Cur calculation
	MHS Cur = Diff1 Work * (Difficulty Accepted / (Difficulty Accepted + Difficulty Rejected + Difficulty Stale)) * 60/ Elapsed * 71582788 / 1000000
	Note：
	1.if Difficulty Accepted + Difficulty Rejected + Difficulty Stale = 0, then Difficulty Accepted / (Difficulty Accepted + Difficulty Rejected + Difficulty Stale) = 1.
	2.Get all the infomation through ./bfgminer-rpc -o summary

* BFGMiner release from luck.dashjr
	http://luke.dashjr.org/programs/bitcoin/files/bfgminer/

#### AvalonMiner
It is developed under Windows with Chinese UI only, You can import the solution and crack it by yourself. It is distributed under UNLICENSE.Source code can be download here:  (7.1)

##### Release
[20140911](http://downloads.canaan-creative.com/software/avalon_nano/software/20140911/)

* Avalon3 nano windows miner(20140911)
* Beautifull GUI 
* Auto detect Avalon nano

[20140803](http://downloads.canaan-creative.com/software/avalon_nano/software/20140803/)

* Avalon3 nano windows miner(20140803) first version
* Support bfgminer only
* Support icarus protocal

##### Run or Debug with CLI

1. Copy BfgMiner to a safe place.
1. Uninstall Avalon GUI Miner
1. Modify the icadbg.cmd(under BfgMiner folder) with your correct com port.
1. Double click icadbg.cmd.
Note: BFGMiner location: (C:\Program Files (x86)\Avalon Nano\BfgMiner)

### Hardware
#### Schematics

* [Avalon-usb schematics](http://downloads.canaan-creative.com/software/avalon_nano/doc/sch/Avalon_usb_sch.pdf)

#### LPC11U14 Spec


|Type |Infomation
|Processor |NXP's Cortex-M0 LPC11U14 microcontroller
|Flash |32 kB
|Data Memory |6 kB
|Clock Crystals |12.000 MHz crystal for CPU


#### Clock


|Type  |Value
|LPC11U14 (External)    |48.000 MHz 
|A3233 XCLK (From LPC11U14)  |24.000 MHz


#### LED


|Color |Memo
|Green |Idle status
|Red/Blue |Working (Frequency high -> low,led red -> blue)
|Red blinking |Overheating


#### Programmer

* SmartPro 5000U-Plus

#### SWD Debuger
LPC11U14 only support swd debug.
The debugger can also be used to program the LPC11U14 chip.
##### LPCXpresso

* Installation and Activation
	LPCXpresso download link  (17.1)
	Free Edition is enough. Then activate it.  (17.2)

* LPC-Link diagnostics
	Diagnostics when connecting to LPC-Link
	
	1.  lpc-link info
	crt_emu_lpc11_13_nxp -info-emu -wire=winusb
	
	2.  target info 
	crt_emu_lpc11_13_nxp -info-target -pLPC11U14/201 -wire=winusb -4
	
	3. burn and run axf file
	crt_emu_lpc11_13_nxp -pLPC11U14/201 -wire=winusb -flash-load-exec nxp_lpcxpresso_11u14_periph_blinky.axf
	
	4. info scan
	crt_emu_lpc11_13_nxp -info-scan -wire=winusb
	
	5. semi_host debug
	use newlib semihost

* How to debug issues with gdb (Works on OSX)
	Compile the souce with debug, then run gdb with the following commands:
	1.arm-none-eabi-gdb avalon_nano.axf
	2.target extended-remote  crt_emu_cm_redlink -g -2 -vendor=NXP -pLPC11U14/201 -flash-driver=LPC11_12_13_32K_4K.cfx
	3.load
	
	Then you can use gdb as you want

##### ULINK 2

* Configure ULINK2 for LPCXpresso
	1.Change boot mode to CMSIS-DAP
	Use the [Boot Mode Utility](http://www.keil.com/support/man/docs/ulink2/ulink2_boot_mode.htm) to change the mode like this: UL2_Configure B1.
	
	2.Set jumper to 3.3V position
	See [ Jumpers](http://www.keil.com/support/man/docs/ulink2/ulink2_hw_jumpers.htm)
	
	3.Connect Avalon nano to ULINK2
	Check [SWD Connector Pinout](http://support.code-red-tech.com/CodeRedWiki/HardwareDebugConnections), need connect SCLK,SWIO,GND only.

### Firmware
#### Reflash

* Avalon3 nano firmware burner  (20.1)

#### Release
[20140523](http://downloads.canaan-creative.com/software/avalon_nano/firmware/20140523/)

* Avalon3 nano firmware(20140523-dd84b993)
* Support nonce receive timeout check
* Support adjust freq for 100Mhz to 360Mhz,freq value after reset is 360Mhz

[20140519](http://downloads.canaan-creative.com/software/avalon_nano/firmware/20140519/)

* Avalon3 nano firmware(20140519-8c38877c):first version
* Avalon3 nano test scripts found here:[a3233_avalon_usb_testbench.sh](https://github.com/BitSyncom/avalon-extras/tree/master/scripts)
* Support adjust freq for 360Mhz to 400Mhz,value after reset is 400Mhz
* Include avalon3 nano module test(avalon_bsp_testben)
* bfgminer(0676fa314a9cc1491ad2e5f5c6a5e97f38fa67e3),how to run:http://wiki.0xf8.com/index.php/Bfgminer

[NEXT-TESTING](http://downloads.canaan-creative.com/software/avalon_nano/firmware/nexttesting/)

* NOTICE: Only for testing
* Adjust LED color according to the temperature

### Review

* https://bitcointalk.org/index.php?topic=1022764.0

### Issues

* OpenOCD is not support ULINK2 (See src/jtag/drivers/ulink.c)

## References

3.1: http://www.lpcware.com/system/files/lpcopen_examples_windows_usb_drivers_v1_10_0.zip  
7.1: https://github.com/Canaan-Creative/Avalon-nano/tree/master/gui_1.0  
17.1: https://www.lpcware.com/lpcxpresso/download  
17.2: http://www.lpcware.com/lpcxpresso/activate  
20.1: http://downloads.canaan-creative.com/software/avalon_nano/burner


## Links

* [LPC11U1X User Manual](http://www.nxp.com/documents/user_manual/UM10462.pdf)
* [LPCOpen sourcecode](http://www.lpcware.com/content/nxpfile/lpcopen-software-development-platform-lpc11xx-packages-0)
* [LPCOpen docs](http://docs.lpcware.com/lpcopen/v1.03/)
* [LPC11U14 Rev A Schematic](http://www.lpcware.com/system/files/LPCXpressoLPC11U14revA_0.pdf)
* [Errata sheet LPC11U1x](http://www.nxp.com/documents/errata_sheet/ES_LPC11U1X.pdf)
* [Using command line GDB](http://support.code-red-tech.com/CodeRedWiki/UsingGDB?highlight=%28LPC\-Link%29)
* Baremetal programming
	* http://eleceng.dit.ie/frank/arm/BareMetalLPC1114/index.html
	* http://eewiki.net/display/microcontroller/Getting+Started+with+NXP%27s+LPC11XX+Cortex-M0+ARM+Microcontrollers
	* http://tech.munts.com/MCU/Frameworks/RaspberryPi/expansion/LPC1114/
* ULINK2
	* [ULINK: How to downgrade the firmware of ULINK2/ME](http://www.keil.com/support/docs/3632.htm)
	* [Firmware Upgrade Utility](http://www.keil.com/support/man/docs/ulink2/ulink2_fw_upgrade.htm)
	* [Hardware Checklist](http://www.keil.com/support/man/docs/ulink2/ulink2_trblsh_hwcheck.htm)
	* [Program Flash Example](http://www.keil.com/support/man/docs/uv4/uv4_cl_programflash.htm)
* LPC-Link
	* [Booting LPC-Link](http://www.support.code-red-tech.com/CodeRedWiki/BootingLPCLink?highlight=%28dfu%5C-util%29)
	* [Diagnostics when connecting to LPC-Link](http://www.support.code-red-tech.com/CodeRedWiki/LPCLinkDiagnostics?highlight=%28dfu%5C-util%29)
* [About CMSIS-DAP](http://www.keil.com/support/man/docs/dapdebug/dapdebug_introduction.htm)
* [Porting the CMSIS-DAP debugger to the Cortex-M0 platform](http://www.lpcware.com/content/nxpfile/an11321-porting-cmsis-dap-debugger-cortex-m0-platform)
* [LPC11U14 ARM Cortex-M0 Board](http://microcontrollershop.com/product_info.php?products_id=4838)
* [In-Application Programming (IAP) Code Example](http://www.lpcware.com/content/blog/application-programming-iap-code-example)
* Software for flashing / upgrading firmware
	* [LPCXpresso](http://www.lpcware.com/lpcxpresso/download) (SWD method)
* [Target Connectors](http://www.keil.com/support/man/docs/ulink2/ulink2_hw_connectors.htm)
