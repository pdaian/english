Avalon2 is the second machine of [[Avalon]] project. It uses 55nm ASIC chips.

# Pictures
## A3255
 [[!img "A3255_ASIC.jpg" size=320x320]]

## PCB
 [[!img "Avlaon2-modular-pcb-3d.png" size=320x320]] [[!img "Avlaon2-modular-front.jpg" size=320x320]]  [[!img "Avlaon2-modular-back.JPG" size=320x320]]

 [[!img "Avlaon2-modular-connector-and-fpga.JPG" size=320x320]]  [[!img "Avlaon2-modular-a3255.JPG" size=320x320]]  [[!img "Avlaon2-modular-power-chip.JPG" size=320x320]] 

 [[!img "Avlaon2-modular-fan-connector.jpg" size=320x320]]

## Single modular
 [[!img "Avalon2-single-modular-all-1.jpg" size=320x320]]  [[!img "Avalon2-single-modular-all-2.jpg" size=320x320]]  [[!img "Avalon2-single-modular-all.JPG" size=320x320]]

 [[!img "avalon2-single-modular-set.jpg" size=320x320]]  [[!img "avalon2-modular-with-case-con.jpg" size=320x320]]  [[!img "avalon2-modular-with-case.jpg" size=320x320]]

 [[!img "avalon2-modular-top-side.jpg" size=320x320]]  [[!img "avalon2-modular-connector-side.jpg" size=320x320]]  [[!img "avalon2-modular-FAN-side.jpg" size=320x320]]

 [[!img "avalon2-single-modular-connector-back.jpg" size=320x320]]  [[!img "avalon2-single-modular-connector-front.jpg" size=320x320]]

## Avalon2 parts
 [[!img "avalon2-3modular-connector-back.jpg" size=320x320]]  [[!img "avalon2-3modular-connector-front.jpg" size=320x320]] 

 [[!img "avalon2-usb-serial-connector.jpg" size=320x320]]  [[!img "avalon2-usb-serial-connector-BACK.jpg" size=320x320]]  [[!img "avalon2-how-to-connector.jpg" size=320x320]]

 [[!img "avalon2-fan1.jpg" size=320x320]]  [[!img "avalon2-fan.jpg" size=320x320]]

## Avalon2
 [[!img "avlaon2-front-without-face.jpg" size=320x320]]  [[!img "avalon2-back.jpg" size=320x320]]   [[!img "avalon2-top-1.jpg" size=320x320]]

 [[!img "avalon2-details-1.jpg" size=320x320]]  [[!img "avalon2-details-2.jpg" size=320x320]]  [[!img "avalon2-details-3.jpg" size=320x320]]

 [[!img "avalon2-power.jpg" size=320x320]]  [[!img "avalon2-power-usb.jpg" size=320x320]]  [[!img "avalon2-top.jpg" size=320x320]]

# User manual
## TP LINK WR703N
The USB on the AR9331 has bugs. If you want use serial console, please use the direct serial console on 703N (the **/dev/ttyATH0**). It's far more stable than USB-serial converter. You may want add a USB hub between machine and 703n

## Raspberry Pi
   [[!img "13_ports_usb_hub.png" title="320px " title="thumb " title="The 13 ports USB HUB "]]

* The default firmware IP address is **192.168.0.100**, you can access it by http://192.168.0.100
* You may need update the address/DNS to your local configuration. DO NOT FORGET your IP address.
* If the Raspberry Pi can access internet, cgminer should automatic start

* 8GB Memory card: http://item.jd.com/632744.html
* Reflash: sudo dd if=openwrt-brcm2708-sdcard-vfat-ext4.img of=/dev/sdb bs=4M #/dev/sdb is your memory card
* USB Hub, [UNITEK Y-2132 USB2.0 13ports](http://item.jd.com/511117.html)
* USB WiFi, [EDUP EP-N8508GS](http://item.jd.com/509932.html)

## Using BFGMiner

Avalon 2 units communicate with a UART, usually attached to your host via a generic USB UART adapter.
First, figure out what COM port (or /dev/ttyUSB on Linux) and run BFGMiner with:

<code>bfgminer -S avalonmm:\\.\COM22 --set avalonmm:clock=1500 --set avalonmm:voltage=1 --set avalonmm:fan=80</code>

## Manual by others

* [彩云比特中文评测](http://www.cybtc.com/article-565-1.html)
* [Guide - Dogie's Comprehensive Avalon Avalon2 Setup + Silencer Mod](https://bitcointalk.org/index.php?topic=493358.0)

## Overclock

* Chip Freq: 1700, Voltage: 10750 --> 119GHs
	Extra cooling is recommended, GJPMiningco recommends removing the slide panel that covers the heatsink and adding some fans that blow down into the heatsink - at least 3 fans evenly spaced along the heatsink.

## Avalon3 CGMiner Under Ubuntu 14.04
	sudo apt-get update
	sudo apt-get upgrade
	sudo apt-get install libcurl4-openssl-dev pkg-config libtool libncurses5-dev libudev-dev screen xterm
	sudo apt-get install git-core
	sudo apt-get install openssh-server byobu
	sudo apt-get install autoconf
	sudo apt-get install automake

	Inside your home directory, download Cgminer
	sudo git clone https://github.com/ckolivas/cgminer

	cd cgminer
	sudo ./autogen.sh --enable-avalon2
	sudo make -j 4

	-
	sudo ./cgminer -S /dev/ttyUSB0 --avalon2-freq 500 --avalon2-voltage 7250 --avalon2-fan 50 -o http://stratum.pool:3333 -u  work -p pass 
	or
	sudo ./cgminer -S /dev/ttyUSB0 --avalon2-freq 500 --avalon2-voltage 7250 --avalon2-fan 50 -o http://stratum.pool:3333 -u  work -p pass --api-allow W:192.168.2,W:192.168.2.1 --api-listen $@ 2>./log

If you use cgminer 4.5.0, the command will like this:
	sudo ./cgminer --avalon2-freq 500 --avalon2-voltage 7250 --avalon2-fan 50 -o http://stratum.pool:3333 -u  work -p pass 
	or
	sudo ./cgminer --avalon2-freq 500 --avalon2-voltage 7250 --avalon2-fan 50 -o http://stratum.pool:3333 -u  work -p pass --api-allow W:192.168.2,W:192.168.2.1 --api-listen $@ 2>./log

# The Avalon2
## Power supply
 [[!img "Avalon2_power_supply.jpg" size=300x300]]

## Specification
	315GH/s, 1020W@220V in normal mode. 
	210GH/s, 420W@220V in ECO mode. 

## Avalon2 Single Modular
	Module hash speed: ~105GHS
	Chip operating speed: 1.5GHS 
	Chip working voltage: 1.0V 
	Typical values ​​DH: ~2% 
	Module Power: 24.5A@12V, 294W (excluding fan power consumption). 0.1A @ 5V, 0.5A @ 3.3V. 
	Power Module conversion efficiency: >= 87% 
	Design Operating temperature: 85C (chip temperature), 60C (PCB, temperature sensor measurements) 
	Fan: 4PIN PWM speed control, report fan speed back.
	Include: Single modular, USB Connector
### LEDS
	From bottom (FPGA) to top is 1 to 8:
	1, 2, 3, 4, 5: Blink when found nonce
	6, 7, Data transfer
	8: Error or under testing

# Design Files

* The Hardware design files: http://downloads.canaan-creative.com/hardware/A3255/avalon2/
* A3255 ASIC Datasheet: http://downloads.canaan-creative.com/hardware/A3255/datasheet/

	Package: QFN48-7X7, 0.5mm pitch
	Process node: 55nm
	Core voltage: 0.8 ~ 1.0V
	Chip frequency: 750MHz
	Hashrate: 1.5Gh/s
	Power usage: 1.6~2.45J/Gh on ASIC side
	VDDIO: 3.0 ~ 3.6V

# Source code
	
## Debug port
 [[!img "Avalon3_Debug_Port.jpg" size=320x320]]

* [[https://github.com/BitSyncom/mm/ MM(Miner Manager)]]
* [ The cgminer Avalon2 support](https://github.com/BitSyncom/cgminer/tree/avalon2)
* [OpenWrt LUCI page](https://github.com/BitSyncom/luci/tree/cgminer-webui-avalon2/applications/luci-cgminer)
* [OpenWrt cgminer package, files and config](https://github.com/BitSyncom/cgminer-openwrt-packages)
* [Build script file](https://github.com/BitSyncom/avalon-extras/blob/master/scripts/build-avalon-image.sh)

# Firmware
## [http://downloads.canaan-creative.com/software/avalon2/2014-08-27/ 20140827]

* Merge cgminer to ckolivas's trunk(V4.5.0)
* Support p2pool(with MM Version: [331408-a15cac80](http://downloads.canaan-creative.com/software/avalon3/2014-08-08/))
* Fan speed auto adjust with new method,range support.(cgminer param: --avalon2-fan 50-100 or --avalon2-fan 50)
* Support hotplug usb cable by cgminer.
* Ignore blacklisted and zombie devices on luci status page.

## [http://downloads.canaan-creative.com/software/avalon2/2014-07-19/ 20140719]

* Update OpenWrt to r41240
* Add new parameter for polling delay: --avalon2-polling-delay (Default: 20ms)
* Add new parameter for stratum ignore time: --stratum-ignore (Default: 30s)
* Add LED status on API log
* Support unlimited socket receive size for cgminer-api
* Try to detect module twice when start
* Don't count HW works on hashrate
* Support cgminer restart on status page
* Display indicator status on status page
* Change introduction on luci-cgminer

## [http://downloads.canaan-creative.com/software/avalon2/2014-05-26 20140526]

* Update to OpenWrt r40859, Update cgminer to 4.3.3
* Add option: **--avalon2-cutoff** <arg> Set Avalon2 overheat cut off temperature (default: 88)
* Add option: **--avalon2-fixed-speed** Set Avalon2 fan to fixed speed
* Update default modulars from **3 to 4**
* Only display the module that attached
* Ignore frequent stratum message. make MM have more time to hashing
* Fix the share cannot count to correct device(miner thread)
* Cut the ASIC power when network was down for 3 minutes
* Automatic fan speed adjustment
* New feature. module indicator by using the red led
* Fixed hashrate count when start and ignore disabled module
* **Fixed a bug that may lose hashrate. 5% ~ 8% hashreate improvement.**
* Code improvement: dev type detect, job_id crc16 compare, display GHS, etc.

## [http://downloads.canaan-creative.com/software/avalon2/2014-04-23 20140423]

* Here: http://downloads.canaan-creative.com/software/avalon2/2014-04-23
* Update **CGminer from 4.0.0 to 4.3.0** (You may want read document on **--config** options)
* Update OpenWrt to **r40351** (Linux version 3.10.34)
* Fix a bug that may cause hashrate lose.
* Support 703N, 1043ND-V2 and RaspBerry Pi
* Detect Avalon power good signal in cgminer
* Display GHS(not MHS) on cgminer status page
* Add some text for support both Avalon2 and Avalon3
* Support frequency setting for Avalon2 and Avalon3 chips on cgminer configuration page
* Support voltage setting for Avalon2 and Avalon3 chips  on cgminer configuration page

## [http://downloads.canaan-creative.com/software/avalon2/2014-04-11 20140411]

* Here: http://downloads.canaan-creative.com/software/avalon2/2014-04-11
* Update OpenWrt

## [http://downloads.canaan-creative.com/software/avalon2/2014-03-20 20140320]

* Here: http://downloads.canaan-creative.com/software/avalon2/2014-03-20/
* MM(**201401-1f7d08b0**): read the power good single back.
	* Poweron five small module one by one. good for PSU.
* Update cgminer to **4.0.0**
* Add devs information on status page.

## [http://downloads.canaan-creative.com/software/avalon2/2014-01-23/  20140123]

* Here: http://downloads.canaan-creative.com/software/avalon2/2014-01-23/
* MM(**201401-a3cb3950**): Include the first stable version of MM firmware
* Include the RPi OpenWrt firmware
* Include the 703N OpenWrt firmware 
* Support fixed fan speed, support A3255 frequency from 1G to 2G, support adjust voltage for 0.65v to 1.1v
* Display all modules status include 2 fan, 2 temperature sensors, voltage and frequency
* Voltage display as encode mode. needs to be changed to human readable
* Include an ASIC cores testing python script

## [http://downloads.canaan-creative.com/software/avalon2/NEXT-TESTING/ NEXT-TESTING]

* NOTICE: Only for testing
* Fixed fan speed can be change by users.

# Test plan

* New firmware don't break Avalon for sure
* New firmware don't use all flash. have to keep some space for save configuration
* Either and WiFi(703N) connect works fine
* Cgminer works fine(the kernel user driver, cgminer it self, cgminer-monitor and uci configurations files)
* After configure cgminer. [& Apply](Save) can restart the cgminer
* The Status/API log page works fine
* Test mining. the hashrate should be correct
* Test the cgminer-monitor. make sure it can restart cgminer
* When network was down poweroff ASIC
* Automatic fan adjustment
* Make sure 80/22/4028 open on WAN.
* Test 10 avalon2 single module with one host (703N or RPi)

# Testing on ASIC cores

* The Avalon2/3 MM firmware support testing out of box. no needs particular firmware.
* The host test program is here: https://github.com/BitSyncom/avalon-extras/blob/master/scripts/avalon-mm-modular-test.py
* Please check the code for help

# Donation

* Ngzhang0: [1kBGUHDxmSAegACRB6fcE2vrnVAfPJarW](https://blockchain.info/address/1kBGUHDxmSAegACRB6fcE2vrnVAfPJarW)
* Con Kolivas: [15qSxP1SQcUX3o4nhkfdbgyoWEFMomJ4rZ](https://blockchain.info/address/15qSxP1SQcUX3o4nhkfdbgyoWEFMomJ4rZ)
* Kanoi: [1KanoiBupPiZfkwqB7rfLXAzPnoTshAVmb](https://blockchain.info/address/1KanoiBupPiZfkwqB7rfLXAzPnoTshAVmb)
* Xiangfu: [19BT2rcGStUK23vwrmF6y6s3ZWpxzQQn8x](https://blockchain.info/address/19BT2rcGStUK23vwrmF6y6s3ZWpxzQQn8x)

# Links 

* 55nm open design contest: http://avalon-asics.com/avalon-gen2-55nm-open-source-design-contest/
* Documents release by Avalon: http://downloads.canaan-creative.com/hardware/A3255/
* [[Avalon2_prototype]] by using Avalon1 hardware design

[[zh-cn:阿瓦隆2]]

[[!tag "Hardware"]]
